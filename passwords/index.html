<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Betnix Passwords</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --accent: #2563eb;
      --bg: #f3f4f6;
      --card: #fff;
      --muted: #6b7280;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    body { margin:0; background:var(--bg); color:#111; }
    .container { max-width:600px; margin:40px auto; padding:20px; }
    .card {
      background:var(--card); border-radius:16px; padding:20px;
      box-shadow:0 8px 24px rgba(0,0,0,0.08);
      margin-bottom:20px;
    }
    h1 { font-size:22px; margin-bottom:20px; }
    input, button {
      padding:10px 14px; border-radius:8px; border:1px solid #ddd;
      font-size:15px;
    }
    input { width:100%; margin:6px 0; }
    button { background:var(--accent); color:#fff; border:none; cursor:pointer; }
    button:hover { background:#1d4ed8; }
    .hidden { display:none; }
    .vault-item {
      padding:12px; border:1px solid #eee; border-radius:8px;
      margin:6px 0; background:#fafafa;
    }
    small { color:var(--muted); }
    img.qr { max-width:180px; display:block; margin:10px auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ”‘ Betnix Passwords</h1>

    <!-- Auth -->
    <div id="auth" class="card">
      <input id="username" placeholder="Username" />
      <input id="password" type="password" placeholder="Password" />
      <button id="login">Login</button>
      <button id="register">Register</button>
    </div>

    <!-- 2FA -->
    <div id="twofa" class="card hidden">
      <p>Enter the 6-digit code from your Authenticator app:</p>
      <input id="twofa-code" placeholder="123456" />
      <button id="verify-2fa">Verify</button>
      <div id="qr-setup" class="hidden">
        <p>Scan this QR to enable 2FA:</p>
        <img id="qr" class="qr"/>
      </div>
    </div>

    <!-- Vault -->
    <div id="vault" class="card hidden">
      <h2>Your Vault</h2>
      <div id="entries"></div>
      <input id="title" placeholder="Site" />
      <input id="account" placeholder="Account" />
      <input id="pass" placeholder="Password" />
      <button id="add">Add</button>
    </div>
  </div>

  <script>
    const auth = document.getElementById("auth");
    const vault = document.getElementById("vault");
    const twofa = document.getElementById("twofa");
    const entriesDiv = document.getElementById("entries");

    document.getElementById("register").onclick = async () => {
      const u = username.value, p = password.value;
      await fetch("/api/register", {method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:u,password:p})});
      alert("Registered! Now login.");
    };

    document.getElementById("login").onclick = async () => {
      const u = username.value, p = password.value;
      const res = await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:u,password:p})});
      const data = await res.json();
      if(data.twofa){ auth.classList.add("hidden"); twofa.classList.remove("hidden"); }
      else if(data.ok){ auth.classList.add("hidden"); vault.classList.remove("hidden"); loadVault(); }
      else alert("Login failed");
    };

    document.getElementById("verify-2fa").onclick = async () => {
      const token = document.getElementById("twofa-code").value;
      const res = await fetch("/api/2fa/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token})});
      const data = await res.json();
      if(data.ok){ twofa.classList.add("hidden"); vault.classList.remove("hidden"); loadVault(); }
      else alert("Invalid code");
    };

    document.getElementById("add").onclick = async () => {
      const t=title.value,a=account.value,p=pass.value;
      await fetch("/api/vault",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,account:a,password:p})});
      loadVault();
    };

    async function loadVault(){
      const res = await fetch("/api/vault");
      const items = await res.json();
      entriesDiv.innerHTML="";
      items.forEach(it=>{
        const div=document.createElement("div");
        div.className="vault-item";
        div.innerHTML=`<strong>${it.title}</strong><br/><small>${it.account}</small><br/>${it.password}`;
        entriesDiv.appendChild(div);
      });
    }
  </script>
</body>
</html>
