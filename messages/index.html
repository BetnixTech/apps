<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Betnix Messages</title>
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#f3f6fb;color:#111}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:#fff;box-shadow:0 2px 5px rgba(0,0,0,.05)}
.brand{font-weight:700;font-size:18px;color:#2563eb}
.container{display:flex;height:calc(100vh - 60px)}
.sidebar{width:250px;background:#fff;box-shadow:2px 0 5px rgba(0,0,0,.05);display:flex;flex-direction:column;padding:10px}
.sidebar div.contact{padding:8px;margin-bottom:4px;border-radius:6px;cursor:pointer;border:1px solid transparent}
.sidebar div.contact:hover{background:#f0f0f0;border-color:#ddd}
.main{flex:1;display:flex;flex-direction:column}
.chat-box{flex:1;overflow-y:auto;padding:12px}
.chat-box div.msg{margin-bottom:8px;padding:6px 8px;border-radius:6px;background:#e1e1e1;max-width:80%}
.chat-box div.msg.me{background:#2563eb;color:white;margin-left:auto;text-align:right}
.chat-input{display:flex;padding:8px;border-top:1px solid #ccc}
.chat-input input{flex:1;padding:6px 10px;border-radius:6px;border:1px solid #ccc}
.chat-input button{margin-left:6px;padding:6px 10px;border-radius:6px;border:none;background:#2563eb;color:white;cursor:pointer}
.login{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
.login input{margin:6px;padding:8px;border-radius:6px;border:1px solid #ccc;width:200px}
.login button{margin:6px;padding:8px 12px;border-radius:6px;border:none;background:#2563eb;color:white;cursor:pointer}
</style>
</head>
<body>
<div class="login" id="login-screen">
  <h2>Login with Phone Number</h2>
  <input id="phone" placeholder="Enter phone number">
  <button id="login-btn">Login</button>
</div>

<div class="container" id="chat-screen" style="display:none">
<div class="sidebar" id="contact-list"></div>
<div class="main">
  <div class="chat-box" id="chat-box"></div>
  <div class="chat-input">
    <input id="chat-input" placeholder="Type a message...">
    <button id="send">Send</button>
  </div>
</div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let myPhone = null;
let currentChatPhone = null;

// Login
document.getElementById("login-btn").onclick = () => {
  const phone = document.getElementById("phone").value.trim();
  if (!phone) return;
  myPhone = phone;
  socket.emit("login", { phone });
};

socket.on("login-success", phone => {
  document.getElementById("login-screen").style.display = "none";
  document.getElementById("chat-screen").style.display = "flex";
  addContact(phone); // Add yourself to sidebar
});

// Chat UI
function addContact(phone){
  const sidebar = document.getElementById("contact-list");
  if(document.querySelector(`.contact[data-phone='${phone}']`)) return;
  const div = document.createElement("div");
  div.className = "contact";
  div.dataset.phone = phone;
  div.textContent = phone;
  div.onclick = () => {
    currentChatPhone = phone;
    document.getElementById("chat-box").innerHTML = "";
  };
  sidebar.appendChild(div);
}

document.getElementById("send").onclick = () => {
  const input = document.getElementById("chat-input");
  if (!input.value.trim() || !currentChatPhone) return;
  socket.emit("send-message", { toPhone: currentChatPhone, text: input.value });
  const div = document.createElement("div");
  div.textContent = input.value;
  div.className = "msg me";
  document.getElementById("chat-box").appendChild(div);
  input.value = "";
};

document.getElementById("chat-input").addEventListener("keypress", e=>{
  if(e.key==="Enter") document.getElementById("send").click();
});

socket.on("receive-message", ({fromPhone,text})=>{
  addContact(fromPhone);
  if(currentChatPhone===fromPhone){
    const div = document.createElement("div");
    div.textContent = text;
    div.className = "msg";
    document.getElementById("chat-box").appendChild(div);
  }
});

socket.on("error-message", msg => alert(msg));
</script>
</body>
</html>
