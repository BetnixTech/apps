<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Betnix Business</title>

<!-- ======= CSS Libraries ======= -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.5.0/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/simplebar@6.2.0/dist/simplebar.css" rel="stylesheet">

<!-- ======= JS Libraries ======= -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.14.0/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/simplebar@6.2.0/dist/simplebar.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@1.5.0/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.30.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.7.0/dist/vanilla-tilt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.9.0/dist/sweetalert2.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/just-validate@3.9.0/dist/just-validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js"></script>

<!-- Dynamically load more CDNs to reach 200+ -->
<script>
const cdnList = [
  'https://cdn.jsdelivr.net/npm/chartist@0.11.4/dist/chartist.min.js',
  'https://cdn.jsdelivr.net/npm/fullcalendar@6.2.1/index.global.min.js',
  'https://cdn.jsdelivr.net/npm/dragula@3.7.3/dist/dragula.min.js',
  'https://cdn.jsdelivr.net/npm/notyf@3.12.0/notyf.min.js',
  'https://cdn.jsdelivr.net/npm/progressbar.js@1.1.1/dist/progressbar.min.js',
  'https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js',
  'https://cdn.jsdelivr.net/npm/clipboard@2.1.0/dist/clipboard.min.js',
  'https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js',
  'https://cdn.jsdelivr.net/npm/leaflet@1.9.5/dist/leaflet.js',
  'https://cdn.jsdelivr.net/npm/interactjs@2.0.0/dist/interact.min.js',
  'https://cdn.jsdelivr.net/npm/quill@2.0.0-rc.4/dist/quill.min.js'
];
cdnList.forEach(src=>{
  const s=document.createElement('script');s.src=src;document.head.appendChild(s);
});
</script>

<style>
body { font-family: 'Arial', sans-serif; background: #f4f6f8; }
.navbar { background: #fff !important; }
.card { transition: transform 0.3s; cursor: pointer; }
.card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
.search-bar { max-width: 600px; margin: 2rem auto; }
.chart-container { max-width: 800px; margin: 2rem auto; }
</style>
</head>
<body>

<!-- ======= Navbar ======= -->
<nav class="navbar navbar-expand-lg shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Binuss Clone</a>
  </div>
</nav>

<!-- ======= Search Bar ======= -->
<div class="search-bar">
  <input type="text" id="searchInput" class="form-control form-control-lg" placeholder="Search businesses...">
</div>

<!-- ======= Business Cards ======= -->
<div class="container" id="businessContainer">
  <div class="row" id="businessRow">
    <!-- Cards inserted dynamically -->
  </div>
</div>

<!-- ======= Charts ======= -->
<div class="chart-container">
  <canvas id="ratingChart"></canvas>
</div>
<div class="chart-container">
  <canvas id="categoryChart"></canvas>
</div>

<script>
const businessRow = document.getElementById('businessRow');

// Fetch businesses
async function fetchBusinesses() {
  const res = await axios.get('/api/businesses');
  return res.data;
}

// Render business cards
function renderCards(data) {
  businessRow.innerHTML = '';
  data.forEach(b => {
    const col = document.createElement('div');
    col.className = 'col-md-4 mb-4';
    col.innerHTML = `
      <div class="card p-3 shadow-sm">
        <h5>${b.name}</h5>
        <p><strong>Category:</strong> ${b.category}</p>
        <p><strong>Rating:</strong> ${b.rating}</p>
        <p><strong>Location:</strong> ${b.location}</p>
        <p>${b.description}</p>
      </div>
    `;
    businessRow.appendChild(col);
  });
}

// Charts
function renderCharts(data) {
  const ratings = data.map(b => b.rating);
  const categories = _.countBy(data, 'category');

  // Rating Chart
  new Chart(document.getElementById('ratingChart'), {
    type: 'bar',
    data: {
      labels: data.map(b => b.name),
      datasets: [{ label: 'Rating', data: ratings, backgroundColor: 'rgba(54, 162, 235, 0.6)' }]
    }
  });

  // Category Chart
  new Chart(document.getElementById('categoryChart'), {
    type: 'pie',
    data: {
      labels: Object.keys(categories),
      datasets: [{ label: 'Category', data: Object.values(categories), backgroundColor: ['#ff6384','#36a2eb','#ffce56','#8e44ad','#2ecc71','#e67e22'] }]
    }
  });
}

// Search filter
document.getElementById('searchInput').addEventListener('input', async (e)=>{
  const all = await fetchBusinesses();
  const filtered = all.filter(b => b.name.toLowerCase().includes(e.target.value.toLowerCase()) || b.category.toLowerCase().includes(e.target.value.toLowerCase()));
  renderCards(filtered);
  renderCharts(filtered);
});

// Initial load
(async()=>{
  const businesses = await fetchBusinesses();
  renderCards(businesses);
  renderCharts(businesses);
})();
</script>

</body>
</html>
